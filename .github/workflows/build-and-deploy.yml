name: build and deploy

on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]

jobs:
  build:
#    runs-on: self-hosted
    runs-on: ubuntu-latest
    env:
          NODE_CONFIG_ENV: develop
#           PG_PASS: ${{ secrets.PG_PASS }}
#           DATABASE_URL: postgresql://postgres:${{ secrets.SECRET_PASSWORD }}@postgres/postgres
#           DJANGO_SETTINGS_MODULE: app_name.settings.dev
#           SECRET_KEY: ${{ secrets.SECRET_KEY }}
#           PORT: 8000

    steps:
      - uses: actions/checkout@v1
      - name: Build the docker-compose stack
        run: NODE_CONFIG_ENV=develop docker-compose -f docker-compose.yml up -d
      - name: Check running containers
        run: docker ps -a
      - name: Check logs
        run: docker logs scrinity-api
